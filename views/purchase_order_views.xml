<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Extend Purchase Order form -->
        <record id="view_purchase_order_form_inherit" model="ir.ui.view">
            <field name="name">purchase.order.form.inherit.vendor_assignments</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_form"/>
            <field name="arch" type="xml">

                <!-- Add buttons -->
                <xpath expr="//header" position="inside">
                    <button name="action_initiate_request"
                            string="Initiate Request"
                            type="object"
                            groups="purchase_extension.group_purchase_creator"/>
                    <button name="action_gm_approve"
                            string="GM Approve"
                            type="object"
                            groups="purchase_extension.group_general_manager"/>
                    <button name="action_level1_approve"
                            string="Level 1 Approve"
                            type="object"
                            groups="purchase_extension.group_level1_approval"/>
                    <button name="action_level2_approve"
                            string="Confirm Order"
                            type="object"
                            groups="purchase_extension.group_level2_approval"/>
                </xpath>

                <!-- Add approval state + vendor assignments -->
                <xpath expr="//sheet" position="inside">
            <group>
    <field name="approval_state" readonly="1"/>
</group>


                    <notebook>
                        <page string="Vendor Assignments"
                              groups="purchase_extension.group_general_manager,purchase_extension.group_level1_approval,purchase_extension.group_level2_approval">
                            <field name="vendor_assigned_ids" mode="form">
                                <form string="Vendor Assignment">
                                    <group>
                                        <field name="product_id"/>
                                        <field name="vendor_id"/>
                                        <field name="quantity"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </xpath>

            </field>
        </record>

        <!-- List view for vendor assignments -->
        <record id="view_purchase_vendor_line_list" model="ir.ui.view">
            <field name="name">purchase.vendor.line.list</field>
            <field name="model">purchase.vendor.line</field>
            <field name="arch" type="xml">
                <list>
                    <field name="order_id"/>
                    <field name="product_id"/>
                    <field name="vendor_id"/>
                    <field name="quantity"/>
                </list>
            </field>
        </record>

    </data>
</odoo>
