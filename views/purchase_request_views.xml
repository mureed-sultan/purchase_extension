<odoo>
  <data>

    <!-- Inherit the Purchase Order form -->
    <record id="view_purchase_order_form_inherit_request" model="ir.ui.view">
      <field name="name">purchase.order.form.inherit.request</field>
      <field name="model">purchase.order</field>
      <field name="inherit_id" ref="purchase.purchase_order_form"/>
      <field name="arch" type="xml">

        <!-- HEADER: add our workflow buttons (no 'states'/'attrs', Odoo 18-safe) -->
        <xpath expr="//header" position="inside">
          <!-- Draft -> Initiated -->
          <button name="action_initiate" type="object"
                  string="Initiate Request"
                  class="btn-primary"
                  groups="purchase_extension.group_branch_manager"
                  invisible="approval_state != 'draft'"/>
          <!-- Initiated -> Waiting L1 -->
          <button name="action_send_for_approval" type="object"
                  string="Send for Approval"
                  class="btn-secondary"
                  groups="purchase_extension.group_branch_manager"
                  invisible="approval_state != 'initiated'"/>
          <!-- L1 Approve -->
          <button name="action_approve_level1" type="object"
                  string="Approve (Level 1)"
                  class="btn-success"
                  groups="purchase_extension.group_purchase_approver_l1"
                  invisible="approval_state != 'waiting_l1'"/>
          <!-- L2 Approve -->
          <button name="action_approve_level2" type="object"
                  string="Approve (Level 2)"
                  class="btn-success"
                  groups="purchase_extension.group_purchase_approver_l2"
                  invisible="approval_state != 'waiting_l2'"/>
          <!-- Show approval state next to standard state -->
          <field name="approval_state" widget="statusbar"
                 statusbar_visible="draft,initiated,waiting_l1,waiting_l2,approved"
                 readonly="1"/>
        </xpath>

        <!-- Rename BOTH "Print RFQ" buttons to "Print Demand" -->
        <xpath expr="//header/button[@name='print_quotation']" position="attributes">
          <attribute name="string">Print Demand</attribute>
        </xpath>

        <!-- Rename BOTH "Confirm Order" buttons to "Confirm Order" (keep original method) -->
        <xpath expr="//header/button[@name='button_confirm']" position="attributes">
          <attribute name="string">Confirm Order</attribute>
        </xpath>

        <!-- Add Branch + Initiated By under Vendor/Supplier -->
        <xpath expr="//field[@name='partner_id']" position="after">
          <group>
            <field name="branch_id"/>
            <field name="initiated_by" readonly="1"/>
          </group>
        </xpath>

        <!-- Make Vendor visible to all users but OPTIONAL (model already relaxed) -->
        <xpath expr="//field[@name='partner_id']" position="attributes">
          <attribute name="required">0</attribute>
        </xpath>

        <!-- Make Receipt Reminder required + default checked -->
        <xpath expr="//div[@name='reminder']//field[@name='receipt_reminder_email']" position="attributes">
          <attribute name="required">1</attribute>
          <attribute name="context">{'default_receipt_reminder_email': True}</attribute>
        </xpath>

        <!-- Add a Visibility tab with checkboxes to toggle columns -->
        <xpath expr="//sheet/notebook" position="inside">
          <page string="Visibility">
            <group>
              <field name="show_unit_price"/>
              <field name="show_amounts"/>
              <field name="show_taxes"/>
            </group>
          </page>
        </xpath>

        <!-- Hide/Show columns in the one2many list using our toggles -->
        <xpath expr="//field[@name='order_line']//list//field[@name='price_unit']" position="attributes">
          <attribute name="column_invisible">not parent.show_unit_price</attribute>
        </xpath>
        <xpath expr="//field[@name='order_line']//list//field[@name='price_subtotal']" position="attributes">
          <attribute name="column_invisible">not parent.show_amounts</attribute>
        </xpath>
        <xpath expr="//field[@name='order_line']//list//field[@name='taxes_id']" position="attributes">
          <attribute name="column_invisible">not parent.show_taxes</attribute>
        </xpath>

        <!-- Show totals only when Show Amounts is enabled (optional) -->
        <xpath expr="//field[@name='tax_totals']" position="attributes">
          <attribute name="invisible">not show_amounts</attribute>
        </xpath>

      </field>
    </record>

  </data>
</odoo>
